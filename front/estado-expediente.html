<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Expedientes - Curaduría 2 Cartagena</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/config.js"></script>
</head>
<body>
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <!-- Logo -->
                <div class="logo">
                    <a href="https://curaduria2cartagena.com/" target="_self" aria-label="Logo-curaduria-cartagena2">
                        <img class="logo-img" decoding="async" width="229" height="112" src="images/Logo-curaduria-cartagena2-200x98.png" alt="Logo Curaduría 2 Cartagena" class="img-responsive wp-image-25">
                    </a>
                </div>
                
                <!-- Navigation -->
                <nav class="nav">
                    <a href="https://curaduria2cartagena.com/">Inicio</a>
                    <a href="https://curaduria2cartagena.com/quienes-somos/">Quiénes somos</a>
                    <a href="https://curaduria2cartagena.com/tramites/">Atención y servicios</a>
                    <a href="https://curaduria2cartagena.com/documentacion/">Documentación</a>
                    <a href="https://curaduria2cartagena.com/contactanos/">Participa</a>
                </nav>
                
                <!-- Right side -->
                <div class="header-right">
                    <img src="images/Logo-gov.co_.png" alt="Logo Gov.co">
                    <img src="images/logo-ITA.png" alt="Logo ITA">
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Title Section -->
            <div class="title-section">
                <h1 class="main-title">
                    Consulta de Expedientes
                </h1>
                <div class="title-underline"></div>
            </div>

            <!-- Formulario de búsqueda -->
            <div class="search-form-container">
                <form @submit.prevent="consultarExpediente" class="expediente-search-form">
                    <div class="form-group">
                        <label for="numero">Número de Expediente:</label>
                        <input 
                            type="text" 
                            id="numero" 
                            v-model="numeroExpediente" 
                            required 
                            placeholder="Ej: 0001"
                        >
                    </div>
                    <div class="form-group">
                        <label for="año">Año:</label>
                        <input 
                            type="number" 
                            id="año" 
                            v-model="año" 
                            required 
                            :max="currentYear"
                            placeholder="Ej: 2025"
                        >
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn-search">Consultar</button>
                        <button type="button" class="btn-clear" @click="limpiarBusqueda">Limpiar</button>
                    </div>
                </form>
            </div>

            <!-- Resultado de la búsqueda -->
            <div v-if="expediente" class="expediente-result">
                <h2>Información del Expediente</h2>
                <div class="expediente-info">
                                          <div class="info-group">
                          <label>Número de Expediente:</label>
                          <span>{{ formatearRadicado(expediente.idradicado, expediente.vigencia) }}</span>
                      </div>
                    <div class="info-group">
                        <label>Solicitante:</label>
                        <span>{{ expediente.solicitante }}</span>
                    </div>
                    <div class="info-group">
                        <label>Dirección:</label>
                        <span>{{ expediente.direccion }} - {{ expediente.barrio }}</span>
                    </div>
                    <div class="info-group">
                        <label>Tipo de Licencia:</label>
                        <span>{{ expediente.tipolicencia }}</span>
                    </div>
                    <div class="info-group">
                        <label>Modalidad:</label>
                        <span>{{ expediente.modalidad }}</span>
                    </div>
                    <div class="info-group">
                        <label>Fecha de Radicación:</label>
                        <span>{{ formatearFecha(expediente.fecharadicado) }}</span>
                    </div>
                    <div class="info-group">
                        <label>Estado:</label>
                        <span>{{ expediente.estado }}</span>
                    </div>
                    <div class="info-group">
                        <label>Última Actualización:</label>
                        <span>{{ formatearFecha(expediente.fechaultimoestado) }}</span>
                    </div>
                </div>
            </div>
            <!-- Loading spinner -->
            <div v-if="loading" class="loading-spinner">
                <div class="spinner"></div>
                <p>Consultando expediente...</p>
            </div>

            <!-- Error message -->
            <div v-else-if="error" class="error-message">
                {{ error }}
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-container">
                <div class="footer-content">
                    <!-- Left Column -->
                    <div>
                        <!-- Logo -->
                        <div class="footer-logo">
                          <a class="fusion-no-lightbox" href="https://curaduria2cartagena.com/" target="_self" aria-label="Logo-curaduria-cartagena2">
                            <img class="footer-logo-img" decoding="async" width="229" height="112" src="images/Logo-curaduria-cartagena-ByN3.png" alt="" class="img-responsive wp-image-25" sizes="(max-width: 640px) 100vw, 200px"></a>
                        </div>

                        <!-- Contact Info -->
                        <div class="contact-info">
                            <div class="contact-item">
                                <div class="footer-icon">
                                  <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div>
                                  Dirección:
                                </div>
                            </div>
                            <div class="contact-item-2">
                              <a href="https://www.google.com/maps/place/Curaduria+Urbana+2+de+Cartagena+de+Indias/@10.4231589,-75.5498434,17z/data=!3m1!4b1!4m6!3m5!1s0x8ef62f9fef6347f7:0x14c6997462e05d96!8m2!3d10.4231589!4d-75.5498434!16s%2Fg%2F1ptxp3h31?entry=ttu" target="_blank">Centro, Calle del Candilejo, Carrera 6 # 35-23 Cartagena de Indias (Bolívar)</a>
                            </div>
                            
                            <div class="contact-item">
                                <div class="footer-icon">
                                  <i class="fas fa-clock"></i>
                                </div>
                                <div>
                                  Horario de atención:
                                </div>
                            </div>
                            <div class="contact-item-2">
                              <p>Lunes a viernes, 8 a.m. a 12 m y de 1 p.m. a 5:00 p.m.</p>
                            </div>
                            
                            <div class="contact-item">
                                <div class="footer-icon">
                                  <i class="fas fa-phone contact-phone"></i>
                                </div>
                                <div>Teléfono conmutador: (+57) (605) 6654912</div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="footer-icon">
                                  <i class="fas fa-phone contact-phone"></i>
                                </div>
                                <div>Línea anticorrupción: (+57) (605) 6654912</div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="footer-icon">
                                  <i class="fas fa-envelope"></i>
                                </div>
                                <div>Sede electrónico:</div>
                            </div>
                            <div class="contact-item-2">
                              <a href="http://www.curaduria2cartagena.com">Presente aquí sus peticiones, quejas, reclamos, solicitudes, denuncias (PQRSD)</a>
                            </div>

                            <div class="contact-item">
                              <div class="footer-icon">
                                <i class="fas fa-envelope"></i>
                              </div>
                              <div>Correo de notificaciones judiciales:</div>
                            </div>
                            <div class="contact-item-2">
                              <p>
                                <a mailto="notificacionesjudiciales@curaduria2cartagena.com">notificacionesjudiciales@curaduria2cartagena.com</a> 
                                este correo está destinado EXCLUSIVAMENTE PARA NOTIFICACIONES JUDICIALES Y/O COMUNICACIONES ASOCIADAS a trámites judiciales de la Curaduría 2 de Cartagena
                              </p>
                            </div>
                        </div>

                    </div>

                    <!-- Right Column -->
                    <div class="vigilado-section">
                        <div class="vigilado-logos">
                            <img class="vigilado-logo" src="images/VIGILADO-SNR-200x154.jpg" alt="">
                            <img class="marca-colombia-logo" src="images/MARCA-COLOMBIA-200x196.png" alt="">
                        </div>
                    </div>
                </div>

                <!-- Bottom Footer -->
                <div class="footer-bottom">
                    <p>©2023 Curaduría 2 Cartagena | Desarrollado por Axon Design</p>
                    <div class="footer-links">
                        <a href="#">Términos y condiciones</a>
                        <span>|</span>
                        <a href="#">Política de privacidad</a>
                        <span>|</span>
                        <a href="#">Política de derechos de autor</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    numeroExpediente: '',
                    año: new Date().getFullYear(),
                    expediente: null,
                    busquedaRealizada: false,
                    currentYear: new Date().getFullYear(),
                    error: null,
                    loading: false
                }
            },
            methods: {
                async consultarExpediente() {
                    this.loading = true;
                    this.error = null;
                    try {
                        const response = await fetch(`${API_URL}/expedientes?idradicado=${this.numeroExpediente}&vigencia=${this.año}`);
                        const data = await response.json();
                        
                        if (data.status === 'success' && data.data) {
                            this.expediente = data.data;
                        } else {
                            this.expediente = null;
                            this.error = 'No se encontró información para el expediente consultado';
                        }
                        this.busquedaRealizada = true;
                    } catch (error) {
                        console.error('Error al consultar expediente:', error);
                        this.expediente = null;
                        this.error = 'Ocurrió un error al consultar el expediente. Por favor, intente nuevamente.';
                        this.busquedaRealizada = true;
                    } finally {
                        this.loading = false;
                    }
                },
                limpiarBusqueda() {
                    this.numeroExpediente = '';
                    this.año = this.currentYear;
                    this.expediente = null;
                    this.busquedaRealizada = false;
                    this.error = null;
                },
                formatearFecha(fecha) {
                    return new Date(fecha).toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                },
                formatearRadicado(idradicado, vigencia) {
                    // Obtener los últimos dos dígitos del año
                    const añoCorto = vigencia.toString().slice(-2);
                    
                    // Formatear el idradicado con ceros a la izquierda
                    const idFormateado = idradicado.toString().padStart(4, '0');
                    
                    // Retornar el formato completo
                    return `13001-2-${añoCorto}-${idFormateado}`;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>